<!doctype html>
<html lang="vi">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no"/>
<title>üéÅ Qu√† D·ªÖ Th∆∞∆°ng T·∫∑ng Hyen</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
<style>
  :root{
    --pink:#ff66b2; --bg:#ffe6f2; --soft:#fff0f5;
  }
  html,body{height:100%;margin:0;background:linear-gradient(180deg,#ffd7ec,#ffe6f2);font-family:Poppins,Arial,sans-serif}
  /* Center phone-like container */
  .screen {
    width:100%;
    max-width:430px; /* iPhone 14 Pro */
    height:100vh;
    margin:0 auto;
    background:#fff;
    border-radius:26px;
    box-shadow:0 10px 40px rgba(0,0,0,0.18);
    overflow:hidden;
    position:relative;
    display:flex;
    flex-direction:column;
    padding:14px;
    box-sizing:border-box;
  }

  /* header/title */
  h1{
    margin:4px 0 8px;
    font-size:18px;
    text-align:center;
    background:linear-gradient(45deg,#ff3399,#ff66cc,#ff99ff);
    -webkit-background-clip:text;
    -webkit-text-fill-color:transparent;
    animation:glow 2s infinite alternate;
  }
  @keyframes glow{from{ text-shadow:0 0 5px #fff }to{ text-shadow:0 0 20px #ff99cc }}

  .info{
    background:var(--soft);
    border-radius:12px;
    padding:8px;
    text-align:center;
    color:#cc0066;
    font-weight:600;
    box-shadow:0 4px 12px rgba(255,153,204,0.2);
  }

  .note{
    text-align:center;
    margin:10px 0;
    color:#cc0066;
    font-weight:700;
    font-size:13px;
  }

  /* gifts area */
  .gifts{
    display:flex;
    justify-content:center;
    gap:16px;
    align-items:center;
    margin:8px 0 12px;
  }
  .gift{
    width:88px;height:88px;position:relative;cursor:pointer;
    display:flex;align-items:center;justify-content:center;
    transition:transform .18s ease;
  }
  .gift:active{ transform:scale(.98); }
  .box{
    width:86px;height:86px;border-radius:12px;background:linear-gradient(180deg,#ffb3d9,#ff99cc);
    box-shadow:0 8px 18px rgba(0,0,0,0.15); position:relative;overflow:hidden;
  }
  .lid{
    position:absolute; top:-18px; left:-5%; width:110%; height:26px; border-radius:8px;
    background:var(--pink); box-shadow:0 4px 8px rgba(0,0,0,0.12); transition:transform .6s cubic-bezier(.2,.9,.2,1);
  }
  .gift.open .lid{ transform: translateY(-56px) rotate(-15deg); }

  /* chosen badge */
  .chosen-badge{
    position:absolute; top:6px; right:6px; background:#fff; color:var(--pink);
    padding:4px 6px; border-radius:12px; font-size:12px; font-weight:700; box-shadow:0 4px 8px rgba(0,0,0,0.08);
  }

  /* popup password */
  .popup{
    position:absolute; left:50%; top:50%; transform:translate(-50%,-50%);
    width:88%; max-width:320px; background:var(--soft); border-radius:14px;
    padding:12px; box-shadow:0 8px 30px rgba(255,102,178,0.25); display:none; z-index:60;
    text-align:center;
  }
  .popup input{ width:86%; padding:8px; border-radius:8px; border:2px solid #ffb3d9; outline:none; margin:8px 0; }
  .popup .row{display:flex; gap:8px; justify-content:center; align-items:center;}
  .btn{ background:var(--pink); color:#fff; padding:8px 12px; border-radius:10px; border:none; font-weight:700; cursor:pointer;}
  .btn.secondary{ background:#fff; color:var(--pink); border:2px solid var(--pink); }

  /* hearts */
  .hearts{ position:absolute; inset:0; pointer-events:none; z-index:10; }

  /* chat UI (mini messenger-like) */
  #chatToggle{ position:absolute; left:50%; transform:translateX(-50%); bottom:18px; background:var(--pink); color:#fff;
    padding:10px 16px;border-radius:30px;border:none;font-weight:700;box-shadow:0 8px 20px rgba(255,51,153,0.25); z-index:50;}
  #chatBox{
    position:absolute; right:12px; bottom:72px; width:300px; max-width:80%;
    height:360px; background:#fff; border-radius:14px; box-shadow:0 12px 30px rgba(0,0,0,0.12);
    display:flex; flex-direction:column; overflow:hidden; z-index:55; display:none;
  }
  .chat-header{ background:var(--pink); color:#fff; padding:8px; text-align:center; font-weight:700; }
  .chat-body{ flex:1; padding:10px; overflow:auto; background:linear-gradient(180deg,#fff0f7,#fff); }
  .chat-footer{ padding:8px; display:flex; gap:6px; align-items:center; border-top:1px solid #ffe6f2;}
  .chat-footer input{ flex:1; padding:8px; border-radius:8px; border:1px solid #ffd6ea; }
  .bubble{ display:inline-block; padding:8px 10px; border-radius:12px; max-width:78%; margin:6px 0; line-height:1.2; }
  .from-user{ background:#ffd6ee; color:#400029; margin-left:auto; border-bottom-right-radius:2px; animation:slideInRight .35s ease;}
  .from-admin{ background:#d9f0ff; color:#0a3045; border-bottom-left-radius:2px; animation:slideInLeft .35s ease;}
  @keyframes slideInRight{ from{ transform:translateX(30px); opacity:0;} to{ transform:none; opacity:1; } }
  @keyframes slideInLeft{ from{ transform:translateX(-30px); opacity:0;} to{ transform:none; opacity:1; } }

  /* typing dots */
  .typing{ display:inline-flex; gap:4px; padding:8px 10px; border-radius:12px; background:#d9f0ff; }
  .dot{ width:6px; height:6px; background:#fff; border-radius:50%; opacity:0; animation:blink 1.2s infinite; }
  .dot:nth-child(2){ animation-delay:.15s } .dot:nth-child(3){ animation-delay:.3s }
  @keyframes blink{ 0%,80%,100%{opacity:0} 40%{opacity:1} }

  /* small responsive adjustments */
  @media (max-width:360px){
    .gifts{ gap:10px } .gift{ width:70px;height:70px } .box{ width:68px;height:68px }
  }
</style>
</head>
<body>

<div class="screen">
  <h1>üíñ Qu√† D·ªÖ Th∆∞∆°ng T·∫∑ng Hyen üíñ</h1>

  <div class="info">
    <div><strong>T√™n:</strong> Hu·ª≥nh Th·ª•c Nh√£ Y√™n</div>
    <div><strong>Tu·ªïi:</strong> 17</div>
    <div><strong>Bi·ªát danh:</strong> G·∫•u üêª</div>
  </div>

  <div class="note" style="text-align:center;margin-top:10px;color:#cc0066;font-weight:700;">
    üéë M·ªùi Hyen ch·ªçn 1 h·ªôp qu√† cho Trung Thu n√†y<br><small>(L∆∞u √Ω: Ch·ªâ ƒë∆∞·ª£c nh·∫≠n 1 c√°i duy nh·∫•t)</small>
  </div>

  <div class="gifts" aria-hidden="false">
    <div class="gift" data-id="1" onclick="onGiftClick(this,'Capybara ü¶´')">
      <div class="lid"></div>
      <div class="box"></div>
    </div>
    <div class="gift" data-id="2" onclick="onGiftClick(this,'B·ªô qu·∫ßn √°o üëó')">
      <div class="lid"></div>
      <div class="box"></div>
    </div>
    <div class="gift" data-id="3" onclick="onGiftClick(this,'Makeup üíÑ')">
      <div class="lid"></div>
      <div class="box"></div>
    </div>
  </div>

  <a class="button" href="https://zalo.me/0378099746" target="_blank" rel="noopener">üì≤ Nh·∫Øn Zalo cho Admin</a>

  <!-- popup m·∫≠t kh·∫©u -->
  <div class="popup" id="popup">
    <h3>üîí Nh·∫≠p m·∫≠t kh·∫©u ƒë·ªÉ m·ªü qu√†</h3>
    <input id="passwordInput" type="password" placeholder="Nh·∫≠p m·∫≠t kh·∫©u...">
    <div class="row" style="margin-top:6px">
      <button class="btn" onclick="checkPassword()">X√°c nh·∫≠n</button>
      <button class="btn secondary" onclick="closePopup()">ƒê√≥ng</button>
    </div>
    <p id="popupMsg" style="margin-top:8px;font-weight:700;"></p>
  </div>

  <!-- hearts overlay -->
  <div class="hearts" id="hearts"></div>

  <!-- chat toggle & box -->
  <button id="chatToggle" onclick="toggleChat()">üíå Chat v·ªõi Admin</button>

  <div id="chatBox">
    <div class="chat-header">Chat Admin</div>
    <div class="chat-body" id="chatBody">
      <div class="bubble from-admin">üëã Ch√†o Hyen! M√¨nh l√† Admin ‚Äî b·∫°n c√≥ th·ªÉ nh·∫Øn "tdatdz" ƒë·ªÉ b·∫Øt ƒë·∫ßu mini game nh·∫≠n 50k.</div>
    </div>
    <div class="chat-footer">
      <input id="chatInput" placeholder="Nh·∫≠p tin nh·∫Øn..." />
      <button class="btn" onclick="onSendChat()">G·ª≠i</button>
    </div>
  </div>
</div>

<!-- Audio elements (CDN free sounds) -->
<!-- ting: open gift or success; tung: send message; buzz: fail -->
<audio id="audioTing" src="https://www.soundjay.com/buttons/sounds/button-3.mp3" preload="auto"></audio>
<audio id="audioTung" src="https://www.soundjay.com/buttons/sounds/button-10.mp3" preload="auto"></audio>
<audio id="audioBuzz" src="https://www.soundjay.com/misc/sounds/buzzer-01.mp3" preload="auto"></audio>

<script>
/* ---------- Utilities: sound & vibrate ---------- */
const playSound = async (audioEl) => {
  try{
    // try play (needs user gesture ‚Äî we call after clicks)
    await audioEl.currentTime && (audioEl.currentTime = 0);
    audioEl.play().catch(()=>{}); // swallow play rejection
  }catch(e){}
};
const vibrate = (pattern)=>{ if(navigator.vibrate) navigator.vibrate(pattern); };

/* ---------- Hearts animation ---------- */
function createHeart(){
  const h = document.createElement('div');
  h.className='heart';
  h.style.left = (Math.random()*85+2)+'%';
  h.style.fontSize = (Math.random()*12+12)+'px';
  h.style.animationDuration = (Math.random()*3+4)+'s';
  h.textContent='üíñ';
  document.getElementById('hearts').appendChild(h);
  setTimeout(()=>h.remove(),6000);
}
setInterval(createHeart,500);

/* ---------- Gift logic (only 1 allowed) ---------- */
let chosen = false;
let chosenGiftId = null;
let chosenGiftName = '';

function onGiftClick(el, name){
  if(chosen){
    // if already chosen: tiny feedback
    const audioBuzz = document.getElementById('audioBuzz');
    playSound(audioBuzz);
    vibrate([150,80,150]);
    flashMessage('B·∫°n ch·ªâ ƒë∆∞·ª£c nh·∫≠n 1 m√≥n th√¥i nha!', 'red');
    return;
  }
  // open animation + sound + vibrate
  el.classList.add('open');
  const audioTing = document.getElementById('audioTing');
  playSound(audioTing);
  vibrate(200);
  // set current gift and open popup after lid animation
  chosenGiftId = el.dataset.id;
  chosenGiftName = name;
  setTimeout(()=>openPopup(),700);
}

/* ---------- Popup controls ---------- */
function openPopup(){
  const popup = document.getElementById('popup');
  popup.style.display='block';
  document.getElementById('popupMsg').innerText='';
  document.getElementById('passwordInput').value='';
}
function closePopup(){
  const popup = document.getElementById('popup');
  popup.style.display='none';
  // if closed without success, close lid visuals of gift
  const g = document.querySelector('.gift.open:not(.locked)');
  if(g) g.classList.remove('open');
  chosenGiftId = null;
  chosenGiftName = '';
}
function flashMessage(txt, color='green'){
  const msgEl = document.getElementById('popupMsg');
  msgEl.style.color = color;
  msgEl.innerText = txt;
  setTimeout(()=>{ if(msgEl.innerText===txt) msgEl.innerText=''; },2200);
}

/* ---------- Password check ---------- */
function checkPassword(){
  const pass = document.getElementById('passwordInput').value.trim();
  const msgEl = document.getElementById('popupMsg');
  const audioTing = document.getElementById('audioTing');
  const audioBuzz = document.getElementById('audioBuzz');
  if(pass === 'Anhyeuemhyennhattrenthegioi'){
    // success ‚Äî lock chosen, show message, sound & vibrate
    playSound(audioTing);
    vibrate([80,40,80]);
    msgEl.style.color='green';
    typeText(msgEl, `‚úÖ Ch√∫c m·ª´ng! B·∫°n ƒë√£ ch·ªçn ${chosenGiftName} üéâ`, ()=>{});
    // mark chosen gift as locked (prevent lid close)
    const g = document.querySelector(`.gift[data-id="${chosenGiftId}"]`);
    if(g) g.classList.add('locked');
    chosen = true;
    // show badge "ƒê√£ nh·∫≠n" on chosen gift
    setTimeout(()=>{
      if(g && !g.querySelector('.chosen-badge')){
        const b = document.createElement('div'); b.className='chosen-badge'; b.innerText='ƒê√£ nh·∫≠n';
        g.appendChild(b);
      }
    },800);
    // auto close popup after short delay
    setTimeout(()=>{ document.getElementById('popup').style.display='none'; },2500);
  } else {
    // wrong
    playSound(audioBuzz);
    vibrate([120,80,120]);
    msgEl.style.color='red';
    typeText(msgEl, `‚ùå Sai m·∫≠t kh·∫©u r·ªìi G·∫•u ∆°i!`, ()=>{});
    // also open-close lid small shake
    const g = document.querySelector(`.gift[data-id="${chosenGiftId}"]`);
    if(g){
      g.classList.remove('open');
      setTimeout(()=>g.classList.add('open'),120);
      setTimeout(()=>g.classList.remove('open'),560);
    }
  }
}

/* typing effect helper */
function typeText(el, text, cb){
  el.innerText=''; let i=0;
  const t = setInterval(()=>{ el.innerText += text[i++]||''; if(i>text.length){ clearInterval(t); cb&&cb();}}, 28);
}

/* ---------- Chat & mini game ---------- */
const questions = {
  1: {q:'Th√†nh ƒê·∫°t th√≠ch u·ªëng g√¨ nh·∫•t?', a:'matcha latte'},
  2: {q:'Th√†nh ƒê·∫°t n·∫∑ng bao nhi√™u k√≠', a:'54kg'},
  3: {q:'Th√†nh ƒê·∫°t th√≠ch ƒÉn tr√°i g√¨ [ s·∫ßu ri√™ng , MƒÉn c·ª•t , Kiwi ', a:'s·∫ßu ri√™ng'},
  4: {q:'Th√†nh ƒê·∫°t c√≥ ƒë·∫πp trai ko?', a:'c√≥'},
  5: {q:'Th√†nh ƒê·∫°t cao m√©t m·∫•y?', a:'1m67'}
};
let currentQuestion = null;
let expectingSTK = false;

function toggleChat(){
  const box = document.getElementById('chatBox');
  if(box.style.display==='flex' || box.style.display==='block'){
    box.style.display='none';
  }else{
    box.style.display='flex';
    // focus input
    setTimeout(()=>document.getElementById('chatInput').focus(),120);
  }
}
function toggleChat(){ const box=document.getElementById('chatBox'); box.style.display=(box.style.display==='flex')?'none':'flex'; if(box.style.display==='flex') setTimeout(()=>document.getElementById('chatInput').focus(),120); }

function appendMessage(text, who='admin'){
  const body = document.getElementById('chatBody');
  const d = document.createElement('div');
  const cls = who==='user' ? 'bubble from-user' : 'bubble from-admin';
  d.className = cls;
  d.innerText = text;
  body.appendChild(d);
  body.scrollTop = body.scrollHeight;
}

function showTypingThenReply(replyText, sound='tung', vib=[60]){
  // show typing indicator
  const body = document.getElementById('chatBody');
  const twrap = document.createElement('div'); twrap.className='bubble from-admin';
  const typing = document.createElement('div'); typing.className='typing';
  typing.innerHTML = `<span class="dot"></span><span class="dot"></span><span class="dot"></span>`;
  twrap.appendChild(typing);
  body.appendChild(twrap);
  body.scrollTop = body.scrollHeight;
  // after delay replace with reply
  setTimeout(()=>{
    twrap.remove();
    appendMessage(replyText,'admin');
    // play sound & vibrate
    if(sound==='tung') playSound(document.getElementById('audioTung'));
    else if(sound==='ting') playSound(document.getElementById('audioTing'));
    else if(sound==='buzz') playSound(document.getElementById('audioBuzz'));
    vibrate(vib);
  }, 900 + Math.min(800, replyText.length*15));
}

function onSendChat(){
  const inp = document.getElementById('chatInput');
  let text = (inp.value||'').trim();
  if(!text) return;
  // show user message
  appendMessage(text,'user');
  // play send sound + vibrate
  playSound(document.getElementById('audioTung'));
  vibrate(100);
  inp.value='';
  // process message in lowercase
  const lc = text.toLowerCase();
  // command: "tdatdz" triggers mini-game prompt
  if(lc.includes('tdatdz')){
    showTypingThenReply('B·∫°n c√≤n m·ªôt c√¢u h·ªèi n·∫øu b·∫°n tr·∫£ l·ªùi ƒë√∫ng b·∫°n s·∫Ω nh·∫≠n ƒë∆∞·ª£c 50.000 ƒê·ªìng üí∞. Ch·ªçn 1-5 ƒë·ªÉ l·∫•y c√¢u h·ªèi.', 'tung',[80]);
    currentQuestion = -1; // waiting for choosing number
    return;
  }
  // if waiting for question number
  if(currentQuestion === -1){
    if(/^[1-5]$/.test(lc)){
      currentQuestion = parseInt(lc,10);
      showTypingThenReply(questions[currentQuestion].q,'tung',[60]);
    } else {
      showTypingThenReply('H√£y ch·ªçn 1-5 ƒë·ªÉ l·∫•y c√¢u h·ªèi.', 'buzz', [100,50,100]);
    }
    return;
  }
  // if expecting answer to a question
  if(currentQuestion && currentQuestion>0){
    const correct = questions[currentQuestion].a.toLowerCase();
    if(lc === correct){
      // correct
      showTypingThenReply('‚úÖ Ch√≠nh x√°c r·ªìi! G·ª≠i STK ƒë·ªÉ nh·∫≠n th∆∞·ªüng üí∞', 'ting', [120,40,120]);
      currentQuestion = 0;
      expectingSTK = true;
    } else {
      showTypingThenReply('‚ùå B·∫°n ƒë√£ tr·∫£ l·ªùi sai n√™n coi l·∫°i b·ªì m√¨nh üí¢', 'buzz', [200,100,200]);
      currentQuestion = 0;
    }
    return;
  }
  // if expectingSTK and user sends digits treat as stk send
  if(expectingSTK && /\d{6,20}/.test(lc.replace(/\s+/g,''))){
    showTypingThenReply('üí∏ Ti·ªÅn s·∫Ω + v√†o t√†i kho·∫£n c·ªßa b·∫°n ngay √≠t ph√∫t!', 'ting', [120,40,120]);
    expectingSTK = false;
    return;
  }

  // friendly default replies
  if(lc.includes('b·∫°n l√† hyen') || lc.includes('b·∫°n l√† hyen ph·∫£i kh√¥ng')){
    showTypingThenReply('Ch√†o Hyen t√¥i s·∫Ω ƒë√°p ·ª©ng m·ªçi nhu c·∫ßu c·ªßa b·∫°n t·∫°i v√¨ b·∫°n l√† b·ªì y√™u c·ªßa TDAT üòò', 'tung', [60]);
    return;
  }
  showTypingThenReply('M√¨nh ch∆∞a hi·ªÉu. G√µ "tdatdz" ƒë·ªÉ ch∆°i mini game nh·∫≠n 50k nh√©!', 'tung', [40]);
}

/* ---------- init: small auto-messages for friendliness ---------- */
setTimeout(()=>{ appendMessage('üí¨ G·ª£i √Ω: Nh·∫Øn "B·∫°n l√† Hyen ph·∫£i kh√¥ng?" ho·∫∑c "tdatdz" ƒë·ªÉ ch∆°i mini game.', 'admin') }, 1200);

/* ---------- Helper: click anywhere to allow audio play in some browsers ---------- */
document.addEventListener('click', function firstClickAllowAudio(){
  // try to resume audio contexts by playing then pausing (best-effort)
  const a = document.getElementById('audioTing');
  a.play().then(()=>a.pause()).catch(()=>{});
  document.removeEventListener('click', firstClickAllowAudio);
});

/* ---------- Accessibility: close popup on Escape ---------- */
document.addEventListener('keydown', (e)=>{ if(e.key==='Escape'){ document.getElementById('popup').style.display='none'; } });
</script>
</body>
</html>
